{"ast":null,"code":"var _jsxFileName = \"E:\\\\Project\\\\animal-rescue-adoption-platform\\\\client\\\\src\\\\context\\\\CartContext.js\",\n  _s = $RefreshSig$(),\n  _s2 = $RefreshSig$();\nimport React, { createContext, useContext, useMemo, useState } from 'react';\nimport api from '../api/axios';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst CartCtx = /*#__PURE__*/createContext();\nexport function CartProvider({\n  children\n}) {\n  _s();\n  const [items, setItems] = useState(() => {\n    try {\n      return JSON.parse(localStorage.getItem('cart') || '[]');\n    } catch {\n      return [];\n    }\n  });\n  const persist = nextOrFn => {\n    const next = typeof nextOrFn === 'function' ? nextOrFn(items) : nextOrFn;\n    setItems(next);\n    localStorage.setItem('cart', JSON.stringify(next));\n  };\n  const add = async (product, qty = 1) => {\n    try {\n      // Check latest availability from backend\n      const res = await api.get(`/products/${product._id}`);\n      const fresh = res.data;\n      if (fresh.isSold) return; // silently ignore\n      // If already in cart, do nothing (1 product per user)\n      const exists = items.some(i => i._id === product._id);\n      if (exists) return;\n      persist([...items, {\n        ...fresh,\n        quantity: 1\n      }]);\n    } catch (_) {\n      // ignore add if product not found/unavailable\n    }\n  };\n  const remove = id => persist(items.filter(i => i._id !== id));\n  const clear = () => persist([]);\n  // Lock quantity to 1 for each product\n  const setQuantity = (id, _qty) => persist(items.map(i => i._id === id ? {\n    ...i,\n    quantity: 1\n  } : i));\n  const totals = useMemo(() => {\n    const toNum = s => {\n      const n = Number(String(s).replace(/[^0-9.]/g, ''));\n      return isNaN(n) ? 0 : n;\n    };\n    const subtotal = items.reduce((sum, it) => sum + toNum(it.amount) * (it.quantity || 1), 0);\n    return {\n      subtotal\n    };\n  }, [items]);\n  const value = {\n    items,\n    add,\n    remove,\n    clear,\n    setQuantity,\n    totals\n  };\n  return /*#__PURE__*/_jsxDEV(CartCtx.Provider, {\n    value: value,\n    children: children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 51,\n    columnNumber: 10\n  }, this);\n}\n_s(CartProvider, \"1WEGwgZbV6tz5fZJNILv8U3A43w=\");\n_c = CartProvider;\nexport const useCart = () => {\n  _s2();\n  return useContext(CartCtx);\n};\n_s2(useCart, \"gDsCjeeItUuvgOWf1v4qoK9RF6k=\");\nvar _c;\n$RefreshReg$(_c, \"CartProvider\");","map":{"version":3,"names":["React","createContext","useContext","useMemo","useState","api","jsxDEV","_jsxDEV","CartCtx","CartProvider","children","_s","items","setItems","JSON","parse","localStorage","getItem","persist","nextOrFn","next","setItem","stringify","add","product","qty","res","get","_id","fresh","data","isSold","exists","some","i","quantity","_","remove","id","filter","clear","setQuantity","_qty","map","totals","toNum","s","n","Number","String","replace","isNaN","subtotal","reduce","sum","it","amount","value","Provider","fileName","_jsxFileName","lineNumber","columnNumber","_c","useCart","_s2","$RefreshReg$"],"sources":["E:/Project/animal-rescue-adoption-platform/client/src/context/CartContext.js"],"sourcesContent":["import React, { createContext, useContext, useMemo, useState } from 'react';\r\nimport api from '../api/axios';\r\n\r\nconst CartCtx = createContext();\r\n\r\nexport function CartProvider({ children }) {\r\n  const [items, setItems] = useState(() => {\r\n    try {\r\n      return JSON.parse(localStorage.getItem('cart') || '[]');\r\n    } catch {\r\n      return [];\r\n    }\r\n  });\r\n\r\n  const persist = (nextOrFn) => {\r\n    const next = typeof nextOrFn === 'function' ? nextOrFn(items) : nextOrFn;\r\n    setItems(next);\r\n    localStorage.setItem('cart', JSON.stringify(next));\r\n  };\r\n\r\n  const add = async (product, qty = 1) => {\r\n    try {\r\n      // Check latest availability from backend\r\n      const res = await api.get(`/products/${product._id}`);\r\n      const fresh = res.data;\r\n      if (fresh.isSold) return; // silently ignore\r\n      // If already in cart, do nothing (1 product per user)\r\n      const exists = items.some((i) => i._id === product._id);\r\n      if (exists) return;\r\n      persist([...items, { ...fresh, quantity: 1 }]);\r\n    } catch (_) {\r\n      // ignore add if product not found/unavailable\r\n    }\r\n  };\r\n\r\n  const remove = (id) => persist(items.filter((i) => i._id !== id));\r\n  const clear = () => persist([]);\r\n  // Lock quantity to 1 for each product\r\n  const setQuantity = (id, _qty) => persist(items.map((i) => (i._id === id ? { ...i, quantity: 1 } : i)));\r\n\r\n  const totals = useMemo(() => {\r\n    const toNum = (s) => {\r\n      const n = Number(String(s).replace(/[^0-9.]/g, ''));\r\n      return isNaN(n) ? 0 : n;\r\n    };\r\n    const subtotal = items.reduce((sum, it) => sum + toNum(it.amount) * (it.quantity || 1), 0);\r\n    return { subtotal };\r\n  }, [items]);\r\n\r\n  const value = { items, add, remove, clear, setQuantity, totals };\r\n  return <CartCtx.Provider value={value}>{children}</CartCtx.Provider>;\r\n}\r\n\r\nexport const useCart = () => useContext(CartCtx);\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}