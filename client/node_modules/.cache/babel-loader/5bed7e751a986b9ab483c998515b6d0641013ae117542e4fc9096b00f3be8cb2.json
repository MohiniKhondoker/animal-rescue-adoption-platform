{"ast":null,"code":"var _jsxFileName = \"E:\\\\Project\\\\animal-rescue-adoption-platform\\\\client\\\\src\\\\context\\\\CartContext.js\",\n  _s = $RefreshSig$(),\n  _s2 = $RefreshSig$();\nimport React, { createContext, useContext, useMemo, useState } from 'react';\nimport api from '../api/axios';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst CartCtx = /*#__PURE__*/createContext();\nexport function CartProvider({\n  children\n}) {\n  _s();\n  const [items, setItems] = useState(() => {\n    try {\n      return JSON.parse(localStorage.getItem('cart') || '[]');\n    } catch {\n      return [];\n    }\n  });\n  const persist = nextOrFn => {\n    const next = typeof nextOrFn === 'function' ? nextOrFn(items) : nextOrFn;\n    setItems(next);\n    localStorage.setItem('cart', JSON.stringify(next));\n  };\n  const add = async (product, qty = 1) => {\n    try {\n      // Check latest availability from backend\n      const res = await api.get(`/products/${product._id}`);\n      const fresh = res.data;\n      if (fresh.isSold) return; // silently ignore\n      persist(() => {\n        const existing = items.find(i => i._id === product._id);\n        if (existing) {\n          return items.map(i => i._id === product._id ? {\n            ...i,\n            quantity: (i.quantity || 1) + qty\n          } : i);\n        }\n        return [...items, {\n          ...fresh,\n          quantity: qty\n        }];\n      });\n    } catch (_) {\n      // ignore add if product not found/unavailable\n    }\n  };\n  const remove = id => persist(items.filter(i => i._id !== id));\n  const clear = () => persist([]);\n  const setQuantity = (id, qty) => persist(items.map(i => i._id === id ? {\n    ...i,\n    quantity: qty\n  } : i));\n  const totals = useMemo(() => {\n    const toNum = s => {\n      const n = Number(String(s).replace(/[^0-9.]/g, ''));\n      return isNaN(n) ? 0 : n;\n    };\n    const subtotal = items.reduce((sum, it) => sum + toNum(it.amount) * (it.quantity || 1), 0);\n    return {\n      subtotal\n    };\n  }, [items]);\n  const value = {\n    items,\n    add,\n    remove,\n    clear,\n    setQuantity,\n    totals\n  };\n  return /*#__PURE__*/_jsxDEV(CartCtx.Provider, {\n    value: value,\n    children: children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 53,\n    columnNumber: 10\n  }, this);\n}\n_s(CartProvider, \"1WEGwgZbV6tz5fZJNILv8U3A43w=\");\n_c = CartProvider;\nexport const useCart = () => {\n  _s2();\n  return useContext(CartCtx);\n};\n_s2(useCart, \"gDsCjeeItUuvgOWf1v4qoK9RF6k=\");\nvar _c;\n$RefreshReg$(_c, \"CartProvider\");","map":{"version":3,"names":["React","createContext","useContext","useMemo","useState","api","jsxDEV","_jsxDEV","CartCtx","CartProvider","children","_s","items","setItems","JSON","parse","localStorage","getItem","persist","nextOrFn","next","setItem","stringify","add","product","qty","res","get","_id","fresh","data","isSold","existing","find","i","map","quantity","_","remove","id","filter","clear","setQuantity","totals","toNum","s","n","Number","String","replace","isNaN","subtotal","reduce","sum","it","amount","value","Provider","fileName","_jsxFileName","lineNumber","columnNumber","_c","useCart","_s2","$RefreshReg$"],"sources":["E:/Project/animal-rescue-adoption-platform/client/src/context/CartContext.js"],"sourcesContent":["import React, { createContext, useContext, useMemo, useState } from 'react';\r\nimport api from '../api/axios';\r\n\r\nconst CartCtx = createContext();\r\n\r\nexport function CartProvider({ children }) {\r\n  const [items, setItems] = useState(() => {\r\n    try {\r\n      return JSON.parse(localStorage.getItem('cart') || '[]');\r\n    } catch {\r\n      return [];\r\n    }\r\n  });\r\n\r\n  const persist = (nextOrFn) => {\r\n    const next = typeof nextOrFn === 'function' ? nextOrFn(items) : nextOrFn;\r\n    setItems(next);\r\n    localStorage.setItem('cart', JSON.stringify(next));\r\n  };\r\n\r\n  const add = async (product, qty = 1) => {\r\n    try {\r\n      // Check latest availability from backend\r\n      const res = await api.get(`/products/${product._id}`);\r\n      const fresh = res.data;\r\n      if (fresh.isSold) return; // silently ignore\r\n      persist(() => {\r\n        const existing = items.find((i) => i._id === product._id);\r\n        if (existing) {\r\n          return items.map((i) => (i._id === product._id ? { ...i, quantity: (i.quantity || 1) + qty } : i));\r\n        }\r\n        return [...items, { ...fresh, quantity: qty }];\r\n      });\r\n    } catch (_) {\r\n      // ignore add if product not found/unavailable\r\n    }\r\n  };\r\n\r\n  const remove = (id) => persist(items.filter((i) => i._id !== id));\r\n  const clear = () => persist([]);\r\n  const setQuantity = (id, qty) => persist(items.map((i) => (i._id === id ? { ...i, quantity: qty } : i)));\r\n\r\n  const totals = useMemo(() => {\r\n    const toNum = (s) => {\r\n      const n = Number(String(s).replace(/[^0-9.]/g, ''));\r\n      return isNaN(n) ? 0 : n;\r\n    };\r\n    const subtotal = items.reduce((sum, it) => sum + toNum(it.amount) * (it.quantity || 1), 0);\r\n    return { subtotal };\r\n  }, [items]);\r\n\r\n  const value = { items, add, remove, clear, setQuantity, totals };\r\n  return <CartCtx.Provider value={value}>{children}</CartCtx.Provider>;\r\n}\r\n\r\nexport const useCart = () => useContext(CartCtx);\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}